import{createRequest as e}from"@urql/core";export*from"@urql/core";import*as r from"react";import{createContext as t,useContext as n,useRef as a,useState as u,useCallback as i,useEffect as o,useMemo as c}from"react";import{toPromise as s,take as f,filter as v,onPush as l,subscribe as d,takeWhile as p,onEnd as x}from"wonka";var y=t({}),h=y.Provider,g=y.Consumer;y.displayName="UrqlContext";var k=()=>n(y),q={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},m=(e,r)=>e===r||!(!e||!r||e.key!==r.key),b=(e,r)=>{var t={...e,...r,data:void 0!==r.data||r.error?r.data:e.data,fetching:!!r.fetching,stale:!!r.stale};return((e,r)=>{for(var t in e)if(!(t in r))return!0;for(var n in r)if("operation"===n?!m(e[n],r[n]):e[n]!==r[n])return!0;return!1})(e,t)?t:e},P=(e,r)=>{for(var t=0,n=r.length;t<n;t++)if(e[t]!==r[t])return!0;return!1};function w(e,r){e(r)}function Q(r){var t=a(!0),n=k(),[c,d]=u(q),p=i(((a,u)=>(w(d,{...q,fetching:!0}),s(f(1)(v((e=>!e.hasNext))(l((e=>{t.current&&w(d,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation})}))(n.executeMutation(e(r,a),u||{}))))))),[n,r,d]);return o((()=>(t.current=!0,()=>{t.current=!1})),[]),[c,p]}function S(r,t){var n=a(void 0);return c((()=>{var a=e(r,t);return void 0!==n.current&&n.current.key===a.key?n.current:(n.current=a,a)}),[r,t])}var M=e=>{if(!e._react){var r=new Set,t=new Map;e.operations$&&d((e=>{"teardown"===e.kind&&r.has(e.key)&&(r.delete(e.key),t.delete(e.key))}))(e.operations$),e._react={get:e=>t.get(e),set(e,n){r.delete(e),t.set(e,n)},dispose(e){r.add(e)}}}return e._react},_=(e,r)=>e.suspense&&(!r||!1!==r.suspense);function C(e){var r=k(),t=M(r),n=_(r,e.context),a=S(e.query,e.variables),s=c((()=>{if(e.pause)return null;var u=r.executeQuery(a,{requestPolicy:e.requestPolicy,...e.context});return n?l((e=>{t.set(a.key,e)}))(u):u}),[t,r,a,n,e.pause,e.requestPolicy,e.context]),f=i(((e,r)=>{if(!e)return{fetching:!1};var n=t.get(a.key);if(n){if(r&&null!=n&&"then"in n)throw n}else{var u,i=d((e=>{n=e,u&&u(n)}))(p((()=>r&&!u||!n))(e));if(null==n&&r){var o=new Promise((e=>{u=e}));throw t.set(a.key,o),o}i.unsubscribe()}return n||{fetching:!0}}),[t,a]),v=[r,a,e.requestPolicy,e.context,e.pause],[y,h]=u((()=>[s,b(q,f(s,n)),v])),g=y[1];s!==y[0]&&P(y[2],v)&&h([s,g=b(y[1],f(s,n)),v]),o((()=>{var e=y[0],r=y[2][1],n=!1,a=e=>{n=!0,w(h,(r=>{var t=b(r[1],e);return r[1]!==t?[r[0],t,r[2]]:r}))};if(e){var u=d(a)(x((()=>{a({fetching:!1})}))(e));return n||a({fetching:!0}),()=>{t.dispose(r.key),u.unsubscribe()}}a({fetching:!1})}),[t,y[0],y[2][1]]);var m=i((u=>{var i={requestPolicy:e.requestPolicy,...e.context,...u};w(h,(e=>[n?l((e=>{t.set(a.key,e)}))(r.executeQuery(a,i)):r.executeQuery(a,i),e[1],v]))}),[r,t,a,n,f,e.requestPolicy,e.context]);return[g,m]}function N(e,r){var t=k(),n=S(e.query,e.variables),s=a(r);s.current=r;var f=c((()=>e.pause?null:t.executeSubscription(n,e.context)),[t,n,e.pause,e.context]),v=[t,n,e.context,e.pause],[l,p]=u((()=>[f,{...q,fetching:!!f},v])),y=l[1];f!==l[0]&&P(l[2],v)&&p([f,y=b(l[1],{fetching:!!f}),v]),o((()=>{var e=e=>{w(p,(r=>{var t=b(r[1],e);return r[1]===t?r:(s.current&&r[1].data!==t.data&&(t.data=s.current(r[1].data,t.data)),[r[0],t,r[2]])}))};if(l[0])return d(e)(x((()=>{e({fetching:!!f})}))(l[0])).unsubscribe;e({fetching:!1})}),[l[0]]);var h=i((r=>{var a=t.executeSubscription(n,{...e.context,...r});w(p,(e=>[a,e[1],v]))}),[t,e.context,n]);return[y,h]}function $(e){var r=Q(e.query);return e.children({...r[0],executeMutation:r[1]})}function U(e){var r=C(e);return e.children({...r[0],executeQuery:r[1]})}function j(e){var r=N(e,e.handler);return e.children({...r[0],executeSubscription:r[1]})}export{g as Consumer,y as Context,$ as Mutation,h as Provider,U as Query,j as Subscription,k as useClient,Q as useMutation,C as useQuery,N as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
